/*! platypus - v1.0.0 - 2014-02-17
* https://github.com/lorem--ipsum/platypus
* Copyright (c) 2014 Lorem Ipsum  Licensed ,  */
angular.module("platypus.grammar",[]).factory("$grammar",[function(){return{parser:function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(b){function c(b,c,d){var e,f;for(e=c;d>e;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return Jb!==b&&(Jb>b&&(Jb=0,Kb={line:1,column:1,seenCR:!1}),c(Kb,Jb,b),Jb=b),Kb}function d(a){Lb>Hb||(Hb>Lb&&(Lb=Hb,Mb=[]),Mb.push(a))}function e(d,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=c(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==d?d:h(e,j),e,j,f,i.line,i.column)}function f(){var a;return a=g(),a===v&&(a=r()),a}function g(){var b,c,e,f,j,k;return Nb++,b=Hb,c=i(),c!==v?(32===a.charCodeAt(Hb)?(e=A,Hb++):(e=v,0===Nb&&d(B)),e!==v?(f=h(),f!==v?(32===a.charCodeAt(Hb)?(j=A,Hb++):(j=v,0===Nb&&d(B)),j!==v?(k=g(),k!==v?(Ib=b,c=C(c,f,k),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z),b===v&&(b=i()),Nb--,b===v&&(c=v,0===Nb&&d(y)),b}function h(){var b,c;return Nb++,b=Hb,a.substr(Hb,2)===E?(c=E,Hb+=2):(c=v,0===Nb&&d(F)),c===v&&(a.substr(Hb,3)===G?(c=G,Hb+=3):(c=v,0===Nb&&d(H))),c!==v&&(Ib=b,c=I()),b=c,b===v&&(b=Hb,a.substr(Hb,2)===J?(c=J,Hb+=2):(c=v,0===Nb&&d(K)),c===v&&(a.substr(Hb,2)===L?(c=L,Hb+=2):(c=v,0===Nb&&d(M))),c!==v&&(Ib=b,c=N()),b=c),Nb--,b===v&&(c=v,0===Nb&&d(D)),b}function i(){var b,c,e,f,h,i;return Nb++,b=Hb,c=j(),c!==v?(32===a.charCodeAt(Hb)?(e=A,Hb++):(e=v,0===Nb&&d(B)),e!==v?(f=l(),f!==v?(32===a.charCodeAt(Hb)?(h=A,Hb++):(h=v,0===Nb&&d(B)),h!==v?(i=m(),i!==v?(Ib=b,c=P(c,f,i),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z),b===v&&(b=Hb,c=j(),c!==v?(32===a.charCodeAt(Hb)?(e=A,Hb++):(e=v,0===Nb&&d(B)),e!==v?(f=k(),f!==v?(32===a.charCodeAt(Hb)?(h=A,Hb++):(h=v,0===Nb&&d(B)),h!==v?(i=n(),i!==v?(Ib=b,c=P(c,f,i),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z),b===v&&(b=Hb,c=j(),c!==v?(32===a.charCodeAt(Hb)?(e=A,Hb++):(e=v,0===Nb&&d(B)),e!==v?(f=l(),f!==v?(32===a.charCodeAt(Hb)?(h=A,Hb++):(h=v,0===Nb&&d(B)),h!==v?(i=o(),i!==v?(Ib=b,c=P(c,f,i),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z),b===v&&(b=Hb,40===a.charCodeAt(Hb)?(c=Q,Hb++):(c=v,0===Nb&&d(R)),c!==v?(e=g(),e!==v?(41===a.charCodeAt(Hb)?(f=S,Hb++):(f=v,0===Nb&&d(T)),f!==v?(Ib=b,c=U(e),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z)))),Nb--,b===v&&(c=v,0===Nb&&d(O)),b}function j(){var b,c,e;if(Nb++,b=Hb,c=[],W.test(a.charAt(Hb))?(e=a.charAt(Hb),Hb++):(e=v,0===Nb&&d(X)),e!==v)for(;e!==v;)c.push(e),W.test(a.charAt(Hb))?(e=a.charAt(Hb),Hb++):(e=v,0===Nb&&d(X));else c=z;return c!==v&&(Ib=b,c=Y(c)),b=c,Nb--,b===v&&(c=v,0===Nb&&d(V)),b}function k(){var b,c;return Nb++,b=Hb,a.substr(Hb,10)===$?(c=$,Hb+=10):(c=v,0===Nb&&d(_)),c!==v&&(Ib=b,c=ab(c)),b=c,Nb--,b===v&&(c=v,0===Nb&&d(Z)),b}function l(){var b,c;return Nb++,b=Hb,a.substr(Hb,2)===cb?(c=cb,Hb+=2):(c=v,0===Nb&&d(db)),c===v&&(a.substr(Hb,2)===eb?(c=eb,Hb+=2):(c=v,0===Nb&&d(fb)),c===v&&(a.substr(Hb,6)===gb?(c=gb,Hb+=6):(c=v,0===Nb&&d(hb)),c===v&&(a.substr(Hb,10)===$?(c=$,Hb+=10):(c=v,0===Nb&&d(_)),c===v&&(a.substr(Hb,2)===ib?(c=ib,Hb+=2):(c=v,0===Nb&&d(jb)),c===v&&(a.substr(Hb,8)===kb?(c=kb,Hb+=8):(c=v,0===Nb&&d(lb))))))),c!==v&&(Ib=b,c=ab(c)),b=c,Nb--,b===v&&(c=v,0===Nb&&d(bb)),b}function m(){var b,c,e,f,g,h;if(Nb++,b=Hb,c=o(),c!==v){if(e=[],f=Hb,a.substr(Hb,4)===nb?(g=nb,Hb+=4):(g=v,0===Nb&&d(ob)),g!==v?(h=o(),h!==v?(g=[g,h],f=g):(Hb=f,f=z)):(Hb=f,f=z),f!==v)for(;f!==v;)e.push(f),f=Hb,a.substr(Hb,4)===nb?(g=nb,Hb+=4):(g=v,0===Nb&&d(ob)),g!==v?(h=o(),h!==v?(g=[g,h],f=g):(Hb=f,f=z)):(Hb=f,f=z);else e=z;e!==v?(Ib=b,c=pb(c,e),b=c):(Hb=b,b=z)}else Hb=b,b=z;return Nb--,b===v&&(c=v,0===Nb&&d(mb)),b}function n(){var b,c,e,f;return Nb++,b=Hb,c=o(),c!==v?(a.substr(Hb,5)===rb?(e=rb,Hb+=5):(e=v,0===Nb&&d(sb)),e!==v?(f=o(),f!==v?(Ib=b,c=tb(c,f),b=c):(Hb=b,b=z)):(Hb=b,b=z)):(Hb=b,b=z),Nb--,b===v&&(c=v,0===Nb&&d(qb)),b}function o(){var a,b;return Nb++,a=p(),a===v&&(a=q()),Nb--,a===v&&(b=v,0===Nb&&d(ub)),a}function p(){var b,c,e;if(Nb++,b=Hb,c=[],wb.test(a.charAt(Hb))?(e=a.charAt(Hb),Hb++):(e=v,0===Nb&&d(xb)),e!==v)for(;e!==v;)c.push(e),wb.test(a.charAt(Hb))?(e=a.charAt(Hb),Hb++):(e=v,0===Nb&&d(xb));else c=z;return c!==v&&(Ib=b,c=yb(c)),b=c,Nb--,b===v&&(c=v,0===Nb&&d(vb)),b}function q(){var b,c,e,f;if(Nb++,b=Hb,34===a.charCodeAt(Hb)?(c=Ab,Hb++):(c=v,0===Nb&&d(Bb)),c!==v){for(e=[],Cb.test(a.charAt(Hb))?(f=a.charAt(Hb),Hb++):(f=v,0===Nb&&d(Db));f!==v;)e.push(f),Cb.test(a.charAt(Hb))?(f=a.charAt(Hb),Hb++):(f=v,0===Nb&&d(Db));e!==v?(34===a.charCodeAt(Hb)?(f=Ab,Hb++):(f=v,0===Nb&&d(Bb)),f!==v?(Ib=b,c=Eb(e),b=c):(Hb=b,b=z)):(Hb=b,b=z)}else Hb=b,b=z;return Nb--,b===v&&(c=v,0===Nb&&d(zb)),b}function r(){var a,b;return a=Hb,b=Fb,b!==v&&(Ib=a,b=Gb()),a=b}function s(a,b,c){var d={};return d[b]=[a,c],d}var t,u=arguments.length>1?arguments[1]:{},v={},w={start:f},x=f,y={type:"other",description:"condition"},z=v,A=" ",B={type:"literal",value:" ",description:'" "'},C=function(a,b,c){return s(a,b,c)},D={type:"other",description:"boolean operator"},E="&&",F={type:"literal",value:"&&",description:'"&&"'},G="and",H={type:"literal",value:"and",description:'"and"'},I=function(){return"and"},J="||",K={type:"literal",value:"||",description:'"||"'},L="or",M={type:"literal",value:"or",description:'"or"'},N=function(){return"or"},O={type:"other",description:"primary"},P=function(a,b,c){return{field:a,operator:b,value:c}},Q="(",R={type:"literal",value:"(",description:'"("'},S=")",T={type:"literal",value:")",description:'")"'},U=function(a){return a},V={type:"other",description:"field"},W=/^[a-z]/,X={type:"class",value:"[a-z]",description:"[a-z]"},Y=function(a){return a.join("")},Z={type:"other",description:"range comparator"},$="is between",_={type:"literal",value:"is between",description:'"is between"'},ab=function(a){return a},bb={type:"other",description:"comparator"},cb="==",db={type:"literal",value:"==",description:'"=="'},eb="!=",fb={type:"literal",value:"!=",description:'"!="'},gb="is not",hb={type:"literal",value:"is not",description:'"is not"'},ib="is",jb={type:"literal",value:"is",description:'"is"'},kb="contains",lb={type:"literal",value:"contains",description:'"contains"'},mb={type:"other",description:"multiple values"},nb=" or ",ob={type:"literal",value:" or ",description:'" or "'},pb=function(a,b){return[a].concat(b.map(function(a){return a[1]}))},qb={type:"other",description:"range"},rb=" and ",sb={type:"literal",value:" and ",description:'" and "'},tb=function(a,b){return[a,b]},ub={type:"other",description:"value"},vb={type:"other",description:"integer"},wb=/^[0-9]/,xb={type:"class",value:"[0-9]",description:"[0-9]"},yb=function(a){return parseInt(a.join(""),10)},zb={type:"other",description:"string"},Ab='"',Bb={type:"literal",value:'"',description:'"\\""'},Cb=/^[a-z0-9]/,Db={type:"class",value:"[a-z0-9]",description:"[a-z0-9]"},Eb=function(a){return a.join("")},Fb="",Gb=function(){return void 0},Hb=0,Ib=0,Jb=0,Kb={line:1,column:1,seenCR:!1},Lb=0,Mb=[],Nb=0;if("startRule"in u){if(!(u.startRule in w))throw new Error("Can't start parsing from rule \""+u.startRule+'".');x=w[u.startRule]}if(t=x(),t!==v&&Hb===a.length)return t;throw t!==v&&Hb<a.length&&d({type:"end",description:"end of input"}),e(null,Mb,Lb)}return a(b,Error),{SyntaxError:b,parse:c}}()}}]),function(){var a;a=angular.module("platypus",["platypus.grammar"]),a.factory("platypusUtils",function(){var a,b,c,d,e,f,g,h,i;return e=function(a){return a instanceof Array?function(b){return-1!==a.indexOf(b)}:function(b){return b===a}},i=function(a){return a instanceof Array?function(b){return-1===a.indexOf(b)}:function(b){return b!==a}},a=function(a){return a[0]>a[1]?function(b){return a[0]>=b&&b>=a[1]}:function(b){return a[0]<=b&&b<=a[1]}},d=function(a){return a instanceof Array?function(b){return a.filter(function(a){return-1!==b.search(a)}).length>0}:function(b){return-1!==b.search(a)}},c=function(b,c){switch(b){case"is":case"==":return e(c);case"is not":case"!=":return i(c);case"is between":return a(c);case"contains":return d(c);default:throw"Unknown comparator : "+b}},b={or:function(a,b,d){var e,g,i,j;return h(b)&&h(d)?(e=c(b.operator,b.value),i=c(d.operator,d.value),a.filter(function(a){return e(a[b.field])||i(a[d.field])})):(g=f(a,b),j=f(a,d),g.filter(function(a){return-1===j.indexOf(a)}).concat(j))},and:function(a,b,c){var d,e;return d=f(a,b),e=f(a,c),d.filter(function(a){return-1!==e.indexOf(a)})}},h=function(a){return null==a.and&&null==a.or},f=function(a,c){return null==c.or&&null==c.and?g(c,a):null!=c.or?b.or(a,c.or[0],c.or[1]):null!=c.and?b.and(a,c.and[0],c.and[1]):void 0},g=function(a,b){var d;return d=c(a.operator,a.value),b.filter(function(b){return d(b[a.field])})},{evaluate:f,comparator:c}}),a.filter("platypus",["$grammar","platypusUtils",function(a,b){return function(c,d){var e,f;if(f={},c&&(f.data=c),!d)return f;try{f.data=d instanceof Object?b.evaluate(c,d):b.evaluate(c,a.parser.parse(d))}catch(g){e=g,f.data=void 0,f.error=e.message}return f}}])}.call(this);